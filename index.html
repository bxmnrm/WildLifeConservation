<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rare Species Guardian | NFT Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary: #27ae60;
            --dark: #2c3e50;
            --light: #f8f9fa;
        }
        body { font-family: 'Prompt', sans-serif; background: #eef2f3; margin: 0; padding: 20px; color: var(--dark); }
        .container { max-width: 1100px; margin: auto; }
        
        /* Header & Stats */
        .header { text-align: center; padding: 40px 0; background: linear-gradient(to right, #6a11cb, #2575fc); color: white; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        #status-box { background: rgba(255,255,255,0.2); display: inline-block; padding: 10px 20px; border-radius: 50px; margin-top: 10px; font-size: 0.9em; }

        /* Card Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 50px; }
        .card { background: white; border-radius: 15px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: none; }
        .card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
        .card-img { width: 100%; height: 200px; object-fit: cover; background: #ddd; }
        .card-content { padding: 20px; text-align: center; }
        .price-tag { color: var(--primary); font-size: 1.5em; font-weight: 600; margin: 10px 0; }
        
        /* Button Style */
        .buy-btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1em; cursor: pointer; width: 100%; transition: 0.3s; font-weight: 600; }
        .buy-btn:hover { background: #219150; }

        /* Modern Table */
        .history-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8f9fa; color: #777; font-weight: 600; text-transform: uppercase; font-size: 0.8em; padding: 15px; border-bottom: 2px solid #eee; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.95em; }
        .addr-pill { background: #f1f3f5; padding: 4px 10px; border-radius: 4px; font-family: monospace; color: #555; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Rare Species Guardian</h1>
            <p>‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤‡∏™‡∏á‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Blockchain</p>
            <div id="status-box">
                <span id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask...</span> | 
                <small id="account">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</small>
            </div>
        </div>

        <div class="grid" id="animalGrid">
            </div>

        <div class="history-section">
            <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå (Blockchain Record)</h2>
            <table>
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤</th>
                        <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á (Owner Address)</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.15.0/ethers.min.js";

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ 6 ‡∏ä‡∏ô‡∏¥‡∏î 
        const animals = [
            { id: 'Dugong', name: '‡∏û‡∏∞‡∏¢‡∏π‡∏ô', price: '0.001', img: 'pic/Dugong.jpg' },
            { id: 'RiverMartin', name: '‡∏ô‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏ü‡πâ‡∏≤‡∏´‡∏ç‡∏¥‡∏á‡∏Ø', price: '0.002', img: 'pic/RiverMartin.jpg' },
            { id: 'Kouprey', name: '‡∏Å‡∏π‡∏õ‡∏£‡∏µ', price: '0.003', img: 'pic/Kouprey.jpg' },
            { id: 'EldDeer', name: '‡∏•‡∏∞‡∏°‡∏±‡πà‡∏á', price: '0.001', img: 'pic/EldDeer.jpg' },
            { id: 'Leatherback', name: '‡πÄ‡∏ï‡πà‡∏≤‡∏°‡∏∞‡πÄ‡∏ü‡∏∑‡∏≠‡∏á', price: '0.002', img: 'pic/Leatherback.jpg' },
            { id: 'Tapir', name: '‡∏™‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à', price: '0.001', img: 'pic/Tapir.jpg' }
        ];

        //‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Contract Address ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
        //const contractAddress = "0xf66a7017f7ef4f1f4b2778ea99abe8bab7d8afa0"; // ‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå ‡∏Å‡∏£‡∏π‡∏õ‡∏£‡∏µ‡∏¢‡πå
        const contractAddress = "0xa1a1ba476ea766aa51d08ce8f159380a1712427c"; // ‡∏≠‡∏∏‡∏õ‡∏†‡∏±‡∏°‡∏ì‡πå ‡∏™‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à
        const abi = [
            "function buyCharacter(string memory _name) public payable",
            "function getHistory() public view returns (tuple(string characterName, address owner, uint256 timestamp)[])"
        ];

        let contract;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Card ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ 
        function renderCards() {
            const grid = document.getElementById('animalGrid');
            grid.innerHTML = animals.map(a => `
                <div class="card">
                    <img src="${a.img}" class="card-img" alt="${a.name}">
                    <div class="card-content">
                        <h3>${a.name}</h3>
                        <div class="price-tag">${a.price} ETH</div>
                        <button class="buy-btn" onclick="buy('${a.id}', '${a.price}')">‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå‡∏ô‡πâ‡∏≠‡∏á${a.name}</button>
                    </div>
                </div>
            `).join('');
        }

        async function init() {
            if (window.ethereum) {
                const provider = new ethers.BrowserProvider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                const signer = await provider.getSigner();
                contract = new ethers.Contract(contractAddress, abi, signer);
                
                document.getElementById('account').innerText = accounts[0];
                document.getElementById('status').innerText = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
                renderCards();
                loadHistory();
            }
        }

        async function buy(id, price) {
            try {
                const tx = await contract.buyCharacter(id, { value: ethers.parseEther(price) });

                Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading()
                    }
                });

                await tx.wait();

                Swal.fire(
                    '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏ó‡∏±‡∏Å‡∏©‡πå‡πÅ‡∏•‡πâ‡∏ß!',
                    'success'
                )
                loadHistory();
            } catch (err) {
                Swal.fire(
                    '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    err.message,
                    'error'
                )
            }
        }

        async function loadHistory() {
            const data = await contract.getHistory();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = data.map(item => `
                <tr>
                    <td>${new Date(Number(item.timestamp) * 1000).toLocaleString()}</td>
                    <td><b>${item.characterName}</b></td>
                    <td><span class="addr-pill">${item.owner}</span></td>
                </tr>
            `).reverse().join(''); // ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î 
        }

        window.buy = buy;
        init();
    </script>
</body>
</html> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rare Species Guardian | NFT Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary: #27ae60;
            --dark: #2c3e50;
            --light: #f8f9fa;
        }
        body { font-family: 'Prompt', sans-serif; background: #eef2f3; margin: 0; padding: 20px; color: var(--dark); }
        .container { max-width: 1100px; margin: auto; }
        
        /* Header & Stats */
        .header { text-align: center; padding: 40px 0; background: linear-gradient(to right, #6a11cb, #2575fc); color: white; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        #status-box { background: rgba(255,255,255,0.2); display: inline-block; padding: 10px 20px; border-radius: 50px; margin-top: 10px; font-size: 0.9em; }

        /* Card Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 50px; }
        .card { background: white; border-radius: 15px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: none; }
        .card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }
        .card-img { width: 100%; height: 200px; object-fit: cover; background: #ddd; }
        .card-content { padding: 20px; text-align: center; }
        .price-tag { color: var(--primary); font-size: 1.5em; font-weight: 600; margin: 10px 0; }
        
        /* Button Style */
        .buy-btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1em; cursor: pointer; width: 100%; transition: 0.3s; font-weight: 600; }
        .buy-btn:hover { background: #219150; }

        /* Modern Table */
        .history-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8f9fa; color: #777; font-weight: 600; text-transform: uppercase; font-size: 0.8em; padding: 15px; border-bottom: 2px solid #eee; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 0.95em; }
        .addr-pill { background: #f1f3f5; padding: 4px 10px; border-radius: 4px; font-family: monospace; color: #555; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Rare Species Guardian</h1>
            <p>‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤‡∏™‡∏á‡∏ß‡∏ô‡πÑ‡∏ó‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Blockchain</p>
            <div id="status-box">
                <span id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask...</span> | 
                <small id="account">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</small>
            </div>
        </div>

        <div class="grid" id="animalGrid">
            </div>

        <div class="history-section">
            <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå (Blockchain Record)</h2>
            <table>
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th>‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤</th>
                        <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á (Owner Address)</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.15.0/ethers.min.js";

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ 6 ‡∏ä‡∏ô‡∏¥‡∏î 
        const animals = [
            { id: 'Dugong', name: '‡∏û‡∏∞‡∏¢‡∏π‡∏ô', price: '0.001', img: 'pic/Dugong.jpg' },
            { id: 'RiverMartin', name: '‡∏ô‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏ü‡πâ‡∏≤‡∏´‡∏ç‡∏¥‡∏á‡∏Ø', price: '0.002', img: 'pic/RiverMartin.jpg' },
            { id: 'Kouprey', name: '‡∏Å‡∏π‡∏õ‡∏£‡∏µ', price: '0.003', img: 'pic/Kouprey.jpg' },
            { id: 'EldDeer', name: '‡∏•‡∏∞‡∏°‡∏±‡πà‡∏á', price: '0.001', img: 'pic/EldDeer.jpg' },
            { id: 'Leatherback', name: '‡πÄ‡∏ï‡πà‡∏≤‡∏°‡∏∞‡πÄ‡∏ü‡∏∑‡∏≠‡∏á', price: '0.002', img: 'pic/Leatherback.jpg' },
            { id: 'Tapir', name: '‡∏™‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à', price: '0.001', img: 'pic/Tapir.jpg' }
        ];

        
        const contractAddress = "0xa1a1ba476ea766aa51d08ce8f159380a1712427c"; // ‡∏≠‡∏∏‡∏õ‡∏†‡∏±‡∏°‡∏ì‡πå ‡∏™‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à
        //const contractAddress = "0x6b05960aecde1e28b9f73ce41de040a8f999e052"; // ‡∏≠‡∏∏‡∏õ‡∏†‡∏±‡∏°‡∏ì‡πå ‡πÄ‡∏ï‡πà‡∏≤‡∏°‡∏∞‡πÄ‡∏ü‡∏∑‡∏≠‡∏á
        const abi = [
            "function buyCharacter(string memory _name) public payable",
            "function getHistory() public view returns (tuple(string characterName, address owner, uint256 timestamp)[])"
        ];

        let contract;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Card ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ 
        function renderCards() {
            const grid = document.getElementById('animalGrid');
            grid.innerHTML = animals.map(a => `
                <div class="card">
                    <img src="${a.img}" class="card-img" alt="${a.name}">
                    <div class="card-content">
                        <h3>${a.name}</h3>
                        <div class="price-tag">${a.price} ETH</div>
                        <button class="buy-btn" onclick="buy('${a.id}', '${a.price}')">‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå‡∏ô‡πâ‡∏≠‡∏á${a.name}</button>
                    </div>
                </div>
            `).join('');
        }

        async function init() {
            if (window.ethereum) {
                try {
                    const provider = new ethers.BrowserProvider(window.ethereum);
                    const accounts = await provider.send("eth_requestAccounts", []);
                    const signer = await provider.getSigner();
                    contract = new ethers.Contract(contractAddress, abi, signer);
                    
                    document.getElementById('account').innerText = accounts[0];
                    document.getElementById('status').innerText = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
                    renderCards();
                    loadHistory();
                } catch (e) {
                    console.error(e);
                    document.getElementById('status').innerText = '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
                }
            } else {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask");
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡∏∑‡πâ‡∏≠ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Error ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢)
        async function buy(id, price) {
            try {
                // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                const tx = await contract.buyCharacter(id, { value: ethers.parseEther(price) });

                // 2. ‡πÅ‡∏™‡∏î‡∏á Loading
                Swal.fire({
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏ô Blockchain',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading()
                    }
                });

                // 3. ‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à
                await tx.wait();

                // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                Swal.fire(
                    '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏ó‡∏±‡∏Å‡∏©‡πå‡πÅ‡∏•‡πâ‡∏ß!',
                    'success'
                )
                loadHistory(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á

            } catch (err) {
                console.error(err); // ‡∏î‡∏π Error ‡πÄ‡∏ï‡πá‡∏°‡πÜ ‡πÉ‡∏ô Console (F12)
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏©‡∏≤ Error
                const message = getFriendlyError(err);

                Swal.fire(
                    '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                    message,
                    'error'
                )
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        async function loadHistory() {
            try {
                const data = await contract.getHistory();
                const tbody = document.getElementById('tableBody');
                
                if (data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå</td></tr>`;
                    return;
                }

                tbody.innerHTML = data.map(item => `
                    <tr>
                        <td>${new Date(Number(item.timestamp) * 1000).toLocaleString()}</td>
                        <td><b>${item.characterName}</b></td>
                        <td><span class="addr-pill">${item.owner}</span></td>
                    </tr>
                `).reverse().join(''); // ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î 
            } catch (e) {
                console.log("Error loading history:", e);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á Error ‡∏¢‡∏≤‡∏ß‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏™‡∏±‡πâ‡∏ô‡πÜ
        function getFriendlyError(err) {
            const msg = err.message || "";

            // 1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            if (msg.includes("user rejected") || err.code === 4001 || msg.includes("User denied")) {
                return "‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
            }

            // 2. ‡∏ï‡∏¥‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç require ‡πÉ‡∏ô Solidity (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡∏ã‡πâ‡∏≥)
            if (msg.includes("execution reverted")) {
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á execution reverted
                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô: ... execution reverted: "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤" ...
                const parts = msg.split("execution reverted:");
                if (parts[1]) {
                    // ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î‡∏°‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô " } ]
                    let reason = parts[1].split('"')[1]; 
                    if(!reason) reason = parts[1]; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏õ‡πä‡∏∞
                    return reason.replace(/["}]/g, "").trim(); 
                }
                return "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Transaction Reverted)";
            }

            // 3. ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠
            if (msg.includes("insufficient funds")) {
                return "‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô ETH ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤ Gas)";
            }

            // 4. ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            return "‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)";
        }

        window.buy = buy;
        init();
    </script>
</body>
</html>